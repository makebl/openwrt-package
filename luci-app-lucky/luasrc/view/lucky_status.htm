<%
  local safeURL = luci.sys.exec("cat /etc/lucky/lucky.conf | grep SafeURL |  sed 's/\"//g' | sed 's/: /\\n/g'|sed '1d' ");
  local luckyHttpPort = luci.model.uci.cursor():get("lucky", "lucky", "port");
-%>


<script type="text/javascript">//<![CDATA[

var luckyAdminURL = ""+ window.location.protocol + "//" + window.location.hostname +":"+ `<%=luckyHttpPort%>`+`<%=safeURL%>`;


	XHR.poll(3, '<%=url([[admin]], [[services]], [[lucky_status]])%>', null,
		function(x, data) {
			var tb = document.getElementById('lucky_status');
			if (data && tb)
			{
				if (data.running)
				{
					tb.innerHTML = '<em><b style=\"color:green\"><%:The Lucky service is running.%></b></em>';
					tb.innerHTML +='<br/><br/>' + '<a><b href="' +luckyAdminURL+'"'+' target="_blank">'+luckyAdminURL+'</b></a> '
				}
				else
				{
					tb.innerHTML = '<em><b style=\"color:red\"><%:The Lucky service is not running.%></b></em>';
				}
			}
		}
	);
//]]></script>
<style>.mar-10 {margin-left: 50px; margin-right: 10px;}</style>
<fieldset class="cbi-section">
	<legend><%:Lucky Status%></legend>
	<p id="lucky_status">
		<em><%:Collecting data...%></em>
	</p>
</fieldset>
